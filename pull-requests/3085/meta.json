{"url": "https://api.github.com/repos/KeYProject/key/pulls/3085", "id": 1285640049, "node_id": "PR_kwDOIpmSbc5MoU9x", "html_url": "https://github.com/KeYProject/key/pull/3085", "diff_url": "https://github.com/KeYProject/key/pull/3085.diff", "patch_url": "https://github.com/KeYProject/key/pull/3085.patch", "issue_url": "https://api.github.com/repos/KeYProject/key/issues/3085", "number": 3085, "state": "closed", "locked": false, "title": "Enhance SMT nodes: save solver type & unsat core", "user": {"login": "FliegendeWurst", "id": 12560461, "node_id": "MDQ6VXNlcjEyNTYwNDYx", "avatar_url": "https://avatars.githubusercontent.com/u/12560461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FliegendeWurst", "html_url": "https://github.com/FliegendeWurst", "followers_url": "https://api.github.com/users/FliegendeWurst/followers", "following_url": "https://api.github.com/users/FliegendeWurst/following{/other_user}", "gists_url": "https://api.github.com/users/FliegendeWurst/gists{/gist_id}", "starred_url": "https://api.github.com/users/FliegendeWurst/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FliegendeWurst/subscriptions", "organizations_url": "https://api.github.com/users/FliegendeWurst/orgs", "repos_url": "https://api.github.com/users/FliegendeWurst/repos", "events_url": "https://api.github.com/users/FliegendeWurst/events{/privacy}", "received_events_url": "https://api.github.com/users/FliegendeWurst/received_events", "type": "User", "site_admin": false}, "body": "This is an expanded version of https://git.key-project.org/key/key/-/merge_requests/562.\r\n\r\nOriginal description, modified with additional changes:\r\n\r\nSaves the name of the SMT solver that was able to close a goal in the proof file (and take it into account when loading).\r\nAlso saves the unsat core reported by the SMT solver (currently only enabled for Z3).\r\n\r\n# Why\r\nWhen a goal is closed by applying an SMT solver result, at the moment the solver that was able find an `unsat` result is not saved in the proof. In the saved file, the corresponding line looks like this:\r\n```\r\n    (builtin \"SMTRule\")\r\n```\r\nWhen the proof is reloaded, the SMT solvers are run again. However, when multiple solvers are installed, it is unclear, which of them is used. I think it depends on the current user settings, i.e. the file `proofIndependentSettings.proofs` in the `.key` folder, but I am not sure, as changing the key `[SMTSettings]ActiveSolver` did not produce reliable results on my machine.\r\n\r\n## Further Note\r\nWith this MR, when I load the proof `key.ui/examples/heap/verifyThis17_1_PairInsertionSort/sort.proof.gz` (which currently experiences a timeout on Jenkins, see !558), for replay the Z3 solver is selected instead of CVC5, which decreases the loading time from 15 minutes to under 10 minutes on my machine. So while not solving the root cause of the problem, it may also help with timeout.\r\n\r\n# Feature\r\n* The name of the successful solver and the formulas in the unsat core are stored in the proof file, for example:\r\n```\r\n    (builtin \"SMTRule\" (ifInst \"\"  (formula \"7\")) (ifInst \"\"  (formula \"3\")) (ifInst \"\"  (formula \"2\")) (ifInst \"\"  (formula \"1\")) (solverType \"Z3\"))\r\n```\r\n* When reloading, a solver with the given name is searched for in the available solvers. If available, this one is taken. Otherwise the current default solver is used (Z3).\r\n* If no solverType is specified (legacy proofs), the replay is tried with Z3. It probably has the highest chance to work, most likely the proof was originally done with Z3, since for a long time we only supported this solver.\r\n* [x] There is a switch to completely disable SMT proof search during proof reloading (shows a warning).\r\n\r\n# Open and possible tasks for the future\r\n* [ ] When multiple solvers are run, at least one of them has to return `unsat`, others may return `unknown` for the result to be applicable and close the goal. Currently, for saving one of the solvers that returned `unsat` is selected, but I do not know according to which criteria (probably the one that first appears in the solver union). For the future, the fastest one should be selected.\r\n* [ ] In addition to saving the solver name, we could also save branch specific settings, for example the timeout or some specific options for the solvers (e.g., translation without type hierarchy).", "created_at": "2023-03-22T10:50:43Z", "updated_at": "2023-05-11T15:24:02Z", "closed_at": "2023-05-11T15:24:02Z", "merged_at": "2023-05-11T15:24:02Z", "merge_commit_sha": "6a929470ef499d0331f85df1bae1a5384116ec49", "assignee": {"login": "FliegendeWurst", "id": 12560461, "node_id": "MDQ6VXNlcjEyNTYwNDYx", "avatar_url": "https://avatars.githubusercontent.com/u/12560461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FliegendeWurst", "html_url": "https://github.com/FliegendeWurst", "followers_url": "https://api.github.com/users/FliegendeWurst/followers", "following_url": "https://api.github.com/users/FliegendeWurst/following{/other_user}", "gists_url": "https://api.github.com/users/FliegendeWurst/gists{/gist_id}", "starred_url": "https://api.github.com/users/FliegendeWurst/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FliegendeWurst/subscriptions", "organizations_url": "https://api.github.com/users/FliegendeWurst/orgs", "repos_url": "https://api.github.com/users/FliegendeWurst/repos", "events_url": "https://api.github.com/users/FliegendeWurst/events{/privacy}", "received_events_url": "https://api.github.com/users/FliegendeWurst/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "FliegendeWurst", "id": 12560461, "node_id": "MDQ6VXNlcjEyNTYwNDYx", "avatar_url": "https://avatars.githubusercontent.com/u/12560461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FliegendeWurst", "html_url": "https://github.com/FliegendeWurst", "followers_url": "https://api.github.com/users/FliegendeWurst/followers", "following_url": "https://api.github.com/users/FliegendeWurst/following{/other_user}", "gists_url": "https://api.github.com/users/FliegendeWurst/gists{/gist_id}", "starred_url": "https://api.github.com/users/FliegendeWurst/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FliegendeWurst/subscriptions", "organizations_url": "https://api.github.com/users/FliegendeWurst/orgs", "repos_url": "https://api.github.com/users/FliegendeWurst/repos", "events_url": "https://api.github.com/users/FliegendeWurst/events{/privacy}", "received_events_url": "https://api.github.com/users/FliegendeWurst/received_events", "type": "User", "site_admin": false}], "requested_reviewers": [], "requested_teams": [], "labels": [{"id": 4940939276, "node_id": "LA_kwDOIpmSbc8AAAABJoDADA", "url": "https://api.github.com/repos/KeYProject/key/labels/Proof%20Loading/Saving", "name": "Proof Loading/Saving", "color": "C5DEF5", "default": false, "description": ""}, {"id": 4940939619, "node_id": "LA_kwDOIpmSbc8AAAABJoDBYw", "url": "https://api.github.com/repos/KeYProject/key/labels/SMT", "name": "SMT", "color": "C5DEF5", "default": false, "description": ""}], "milestone": null, "draft": false, "commits_url": "https://api.github.com/repos/KeYProject/key/pulls/3085/commits", "review_comments_url": "https://api.github.com/repos/KeYProject/key/pulls/3085/comments", "review_comment_url": "https://api.github.com/repos/KeYProject/key/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/KeYProject/key/issues/3085/comments", "statuses_url": "https://api.github.com/repos/KeYProject/key/statuses/4601356c0257817d1c47350ce125e7ec89c25ccb", "head": {"label": "FliegendeWurst:saveSolverType", "ref": "saveSolverType", "sha": "4601356c0257817d1c47350ce125e7ec89c25ccb", "user": {"login": "FliegendeWurst", "id": 12560461, "node_id": "MDQ6VXNlcjEyNTYwNDYx", "avatar_url": "https://avatars.githubusercontent.com/u/12560461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FliegendeWurst", "html_url": "https://github.com/FliegendeWurst", "followers_url": "https://api.github.com/users/FliegendeWurst/followers", "following_url": "https://api.github.com/users/FliegendeWurst/following{/other_user}", "gists_url": "https://api.github.com/users/FliegendeWurst/gists{/gist_id}", "starred_url": "https://api.github.com/users/FliegendeWurst/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FliegendeWurst/subscriptions", "organizations_url": "https://api.github.com/users/FliegendeWurst/orgs", "repos_url": "https://api.github.com/users/FliegendeWurst/repos", "events_url": "https://api.github.com/users/FliegendeWurst/events{/privacy}", "received_events_url": "https://api.github.com/users/FliegendeWurst/received_events", "type": "User", "site_admin": false}, "repo": {"id": 595490327, "node_id": "R_kgDOI352Fw", "name": "key", "full_name": "FliegendeWurst/key", "private": false, "owner": {"login": "FliegendeWurst", "id": 12560461, "node_id": "MDQ6VXNlcjEyNTYwNDYx", "avatar_url": "https://avatars.githubusercontent.com/u/12560461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FliegendeWurst", "html_url": "https://github.com/FliegendeWurst", "followers_url": "https://api.github.com/users/FliegendeWurst/followers", "following_url": "https://api.github.com/users/FliegendeWurst/following{/other_user}", "gists_url": "https://api.github.com/users/FliegendeWurst/gists{/gist_id}", "starred_url": "https://api.github.com/users/FliegendeWurst/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FliegendeWurst/subscriptions", "organizations_url": "https://api.github.com/users/FliegendeWurst/orgs", "repos_url": "https://api.github.com/users/FliegendeWurst/repos", "events_url": "https://api.github.com/users/FliegendeWurst/events{/privacy}", "received_events_url": "https://api.github.com/users/FliegendeWurst/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/FliegendeWurst/key", "description": "KeY Theorem Prover for Deductive Java Verification", "fork": true, "url": "https://api.github.com/repos/FliegendeWurst/key", "forks_url": "https://api.github.com/repos/FliegendeWurst/key/forks", "keys_url": "https://api.github.com/repos/FliegendeWurst/key/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/FliegendeWurst/key/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/FliegendeWurst/key/teams", "hooks_url": "https://api.github.com/repos/FliegendeWurst/key/hooks", "issue_events_url": "https://api.github.com/repos/FliegendeWurst/key/issues/events{/number}", "events_url": "https://api.github.com/repos/FliegendeWurst/key/events", "assignees_url": "https://api.github.com/repos/FliegendeWurst/key/assignees{/user}", "branches_url": "https://api.github.com/repos/FliegendeWurst/key/branches{/branch}", "tags_url": "https://api.github.com/repos/FliegendeWurst/key/tags", "blobs_url": "https://api.github.com/repos/FliegendeWurst/key/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/FliegendeWurst/key/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/FliegendeWurst/key/git/refs{/sha}", "trees_url": "https://api.github.com/repos/FliegendeWurst/key/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/FliegendeWurst/key/statuses/{sha}", "languages_url": "https://api.github.com/repos/FliegendeWurst/key/languages", "stargazers_url": "https://api.github.com/repos/FliegendeWurst/key/stargazers", "contributors_url": "https://api.github.com/repos/FliegendeWurst/key/contributors", "subscribers_url": "https://api.github.com/repos/FliegendeWurst/key/subscribers", "subscription_url": "https://api.github.com/repos/FliegendeWurst/key/subscription", "commits_url": "https://api.github.com/repos/FliegendeWurst/key/commits{/sha}", "git_commits_url": "https://api.github.com/repos/FliegendeWurst/key/git/commits{/sha}", "comments_url": "https://api.github.com/repos/FliegendeWurst/key/comments{/number}", "issue_comment_url": "https://api.github.com/repos/FliegendeWurst/key/issues/comments{/number}", "contents_url": "https://api.github.com/repos/FliegendeWurst/key/contents/{+path}", "compare_url": "https://api.github.com/repos/FliegendeWurst/key/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/FliegendeWurst/key/merges", "archive_url": "https://api.github.com/repos/FliegendeWurst/key/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/FliegendeWurst/key/downloads", "issues_url": "https://api.github.com/repos/FliegendeWurst/key/issues{/number}", "pulls_url": "https://api.github.com/repos/FliegendeWurst/key/pulls{/number}", "milestones_url": "https://api.github.com/repos/FliegendeWurst/key/milestones{/number}", "notifications_url": "https://api.github.com/repos/FliegendeWurst/key/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/FliegendeWurst/key/labels{/name}", "releases_url": "https://api.github.com/repos/FliegendeWurst/key/releases{/id}", "deployments_url": "https://api.github.com/repos/FliegendeWurst/key/deployments", "created_at": "2023-01-31T07:25:02Z", "updated_at": "2023-01-30T18:56:41Z", "pushed_at": "2023-06-05T06:43:12Z", "git_url": "git://github.com/FliegendeWurst/key.git", "ssh_url": "git@github.com:FliegendeWurst/key.git", "clone_url": "https://github.com/FliegendeWurst/key.git", "svn_url": "https://github.com/FliegendeWurst/key", "homepage": "https://key-project.org", "size": 141791, "stargazers_count": 0, "watchers_count": 0, "language": null, "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "has_discussions": false, "forks_count": 0, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 0, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": [], "visibility": "public", "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "main"}}, "base": {"label": "KeYProject:main", "ref": "main", "sha": "97f6610f799ea6353cf48e5393e724f4d8634a44", "user": {"login": "KeYProject", "id": 18749969, "node_id": "MDEyOk9yZ2FuaXphdGlvbjE4NzQ5OTY5", "avatar_url": "https://avatars.githubusercontent.com/u/18749969?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KeYProject", "html_url": "https://github.com/KeYProject", "followers_url": "https://api.github.com/users/KeYProject/followers", "following_url": "https://api.github.com/users/KeYProject/following{/other_user}", "gists_url": "https://api.github.com/users/KeYProject/gists{/gist_id}", "starred_url": "https://api.github.com/users/KeYProject/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KeYProject/subscriptions", "organizations_url": "https://api.github.com/users/KeYProject/orgs", "repos_url": "https://api.github.com/users/KeYProject/repos", "events_url": "https://api.github.com/users/KeYProject/events{/privacy}", "received_events_url": "https://api.github.com/users/KeYProject/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 580489837, "node_id": "R_kgDOIpmSbQ", "name": "key", "full_name": "KeYProject/key", "private": false, "owner": {"login": "KeYProject", "id": 18749969, "node_id": "MDEyOk9yZ2FuaXphdGlvbjE4NzQ5OTY5", "avatar_url": "https://avatars.githubusercontent.com/u/18749969?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KeYProject", "html_url": "https://github.com/KeYProject", "followers_url": "https://api.github.com/users/KeYProject/followers", "following_url": "https://api.github.com/users/KeYProject/following{/other_user}", "gists_url": "https://api.github.com/users/KeYProject/gists{/gist_id}", "starred_url": "https://api.github.com/users/KeYProject/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KeYProject/subscriptions", "organizations_url": "https://api.github.com/users/KeYProject/orgs", "repos_url": "https://api.github.com/users/KeYProject/repos", "events_url": "https://api.github.com/users/KeYProject/events{/privacy}", "received_events_url": "https://api.github.com/users/KeYProject/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/KeYProject/key", "description": "KeY Theorem Prover for Deductive Java Verification", "fork": false, "url": "https://api.github.com/repos/KeYProject/key", "forks_url": "https://api.github.com/repos/KeYProject/key/forks", "keys_url": "https://api.github.com/repos/KeYProject/key/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/KeYProject/key/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/KeYProject/key/teams", "hooks_url": "https://api.github.com/repos/KeYProject/key/hooks", "issue_events_url": "https://api.github.com/repos/KeYProject/key/issues/events{/number}", "events_url": "https://api.github.com/repos/KeYProject/key/events", "assignees_url": "https://api.github.com/repos/KeYProject/key/assignees{/user}", "branches_url": "https://api.github.com/repos/KeYProject/key/branches{/branch}", "tags_url": "https://api.github.com/repos/KeYProject/key/tags", "blobs_url": "https://api.github.com/repos/KeYProject/key/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/KeYProject/key/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/KeYProject/key/git/refs{/sha}", "trees_url": "https://api.github.com/repos/KeYProject/key/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/KeYProject/key/statuses/{sha}", "languages_url": "https://api.github.com/repos/KeYProject/key/languages", "stargazers_url": "https://api.github.com/repos/KeYProject/key/stargazers", "contributors_url": "https://api.github.com/repos/KeYProject/key/contributors", "subscribers_url": "https://api.github.com/repos/KeYProject/key/subscribers", "subscription_url": "https://api.github.com/repos/KeYProject/key/subscription", "commits_url": "https://api.github.com/repos/KeYProject/key/commits{/sha}", "git_commits_url": "https://api.github.com/repos/KeYProject/key/git/commits{/sha}", "comments_url": "https://api.github.com/repos/KeYProject/key/comments{/number}", "issue_comment_url": "https://api.github.com/repos/KeYProject/key/issues/comments{/number}", "contents_url": "https://api.github.com/repos/KeYProject/key/contents/{+path}", "compare_url": "https://api.github.com/repos/KeYProject/key/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/KeYProject/key/merges", "archive_url": "https://api.github.com/repos/KeYProject/key/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/KeYProject/key/downloads", "issues_url": "https://api.github.com/repos/KeYProject/key/issues{/number}", "pulls_url": "https://api.github.com/repos/KeYProject/key/pulls{/number}", "milestones_url": "https://api.github.com/repos/KeYProject/key/milestones{/number}", "notifications_url": "https://api.github.com/repos/KeYProject/key/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/KeYProject/key/labels{/name}", "releases_url": "https://api.github.com/repos/KeYProject/key/releases{/id}", "deployments_url": "https://api.github.com/repos/KeYProject/key/deployments", "created_at": "2022-12-20T17:32:07Z", "updated_at": "2023-06-05T06:04:05Z", "pushed_at": "2023-06-10T23:11:33Z", "git_url": "git://github.com/KeYProject/key.git", "ssh_url": "git@github.com:KeYProject/key.git", "clone_url": "https://github.com/KeYProject/key.git", "svn_url": "https://github.com/KeYProject/key", "homepage": "https://key-project.org", "size": 143621, "stargazers_count": 18, "watchers_count": 18, "language": "Java", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "has_discussions": true, "forks_count": 11, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 353, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": ["formal-verification", "key", "smt-solver", "static-analysis"], "visibility": "public", "forks": 11, "open_issues": 353, "watchers": 18, "default_branch": "main"}}, "_links": {"self": {"href": "https://api.github.com/repos/KeYProject/key/pulls/3085"}, "html": {"href": "https://github.com/KeYProject/key/pull/3085"}, "issue": {"href": "https://api.github.com/repos/KeYProject/key/issues/3085"}, "comments": {"href": "https://api.github.com/repos/KeYProject/key/issues/3085/comments"}, "review_comments": {"href": "https://api.github.com/repos/KeYProject/key/pulls/3085/comments"}, "review_comment": {"href": "https://api.github.com/repos/KeYProject/key/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/KeYProject/key/pulls/3085/commits"}, "statuses": {"href": "https://api.github.com/repos/KeYProject/key/statuses/4601356c0257817d1c47350ce125e7ec89c25ccb"}}, "author_association": "MEMBER", "auto_merge": null, "active_lock_reason": null}